<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Trick Turn</title>

    <!--Copied from Phaser's Getting Started Tutorial -->
    <script src="js/phaser.min.js"></script>
    <style type="text/css">
     body {
         margin: 0;
     }
    </style>

  </head>
  <body>
      <script type="text/javascript">

       var game = new Phaser.Game(800, 512, Phaser.AUTO, '', { preload: preload, create: create, update: update });

       var timerText;
       var player; var background; var barrier; var map; 

       function preload() {
	   game.load.image('sky', 'assets/sky.png');
       game.load.tilemap('tilemap', 'assets/map.json', null, Phaser.Tilemap.TILED_JSON);
       game.load.image('roadTiles', 'models/roads/preview.jpg');
       game.load.image('grassTiles', 'models/roads/grass.png');
       game.load.spritesheet('student', 'assets/student.png', 50, 50);
       }

       function create() {
	   //  We're going to be using physics, BUT WE MAY CHANGE TO BOX2D
	   game.physics.startSystem(Phaser.Physics.ARCADE);

	   //  A simple background for our 
       map = game.add.tilemap('tilemap');
       map.addTilesetImage('road', 'roadTiles');
       map.addTilesetImage('grass', 'grassTiles');

       // create background, add collisions
       barrier = map.createLayer('Barrier');
       background = map.createLayer('Background')
       barrier.resizeWorld();

       map.setCollisionBetween(1, 100, true, 'Barrier');


	   // The player and its settings
	   player = game.add.sprite(50, game.world.height - 150, 'student');

       player.animations.add('rwalk', [0,1]);
       player.animations.add('lwalk', [2,3]);
       player.animations.add('celebrate', [4,5]);

	   //  We need to enable physics on the player
	   game.physics.arcade.enable(player);

	   //  Player physics properties.
	   player.body.collideWorldBounds = true;

       game.camera.follow(player);

	   cursors = game.input.keyboard.createCursorKeys();

	   // Start a timer that ends the game after two minutes
	   game.time.events.add(Phaser.Timer.SECOND * 5, endGame, this);

	   timerText = game.add.text(
	       16, 16, 'Time Remainining :',
	       { fontSize: '32px', fill: '#000' });
       }

       function endGame(){
	   // From basics tutorial on adding text
	   var text = "Game Over!!";
	   var style = { font: "65px Arial", fill: "#ff0044", x : 400, y : 256};
	   var t = game.add.text(game.world.centerX-200, game.world.centerY,
				 text, style);
       }

       /*function render(){

            game.debug.cameraInfo(game.camera, 32, 32);
            game.debug.spriteCoords(player, 32, 250);

       }*/

       function update() {
	   //from http://stackoverflow.com/questions/8043026/javascript-format-number-to-have-2-digit

       // enable collisions between sprite, barrier
       game.physics.arcade.collide(player, barrier);

	   timerText.text = 'Time remaining: '
			  + Math.floor(game.time.events.duration/60000)
			  + ':' + Math.floor(game.time.events.duration/1000)
				.toLocaleString('en-US',
						{minimumIntegerDigits: 2,
						 useGrouping:false}); 
	   
	   player.body.velocity.x = 0;
	   player.body.velocity.y = 0;
	   
	   if (cursors.left.isDown)
	       {
		   //  Move to the left
		   player.body.velocity.x = -150;
           player.animations.play('lwalk', 5, true);
	       }
	   else if (cursors.right.isDown)
	       {
		   //  Move to the right
		   player.body.velocity.x = 150;
           player.animations.play('rwalk', 5, true);
	       }
	   else if (cursors.up.isDown)
	       {
		   // Move up
		   player.body.velocity.y = -150;
	       }
	   else if (cursors.down.isDown)
	       {
		   // Move down
		   player.body.velocity.y = 150;
	       }

       }      
      </script>
  </body>
</html>
